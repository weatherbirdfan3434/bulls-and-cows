import random
import re
round_number = 1

# create 4-digit secret code
secret_code = []
avail_digits = [x for x in range(10)]
for i in range(4):
	secret_code.append(avail_digits.pop(random.randint(0,len(avail_digits)-1)))
	
#collect user input
while True:
	# get user guess
	raw_guess = input("What do you think my secret code is [Enter 4-digit number, and you cannot have two or more of the same digit.]? ")
	#check to see if digits are unique
	zeros = re.findall("[0]", raw_guess)
	ones = re.findall("[1]", raw_guess)
	twos = re.findall("[2]", raw_guess)
	threes = re.findall("[3]", raw_guess)
	fours = re.findall("[4]", raw_guess)
	fives = re.findall("[5]", raw_guess)
	sixes = re.findall("[6]", raw_guess)
	sevens = re.findall("[7]", raw_guess)
	eights = re.findall("[8]", raw_guess)
	nines = re.findall("[9]", raw_guess)
	# validate input
	if raw_guess.isdigit() and len(raw_guess) == 4 and len(zeros) <= 1 and len(ones) <= 1 and len(twos) <= 1 and len(threes) <= 1 and len(fours) <= 1 and len(fives) <= 1 and len(sixes) <= 1 and len(sevens) <= 1 and len(eights) <= 1 and len(nines) <= 1:
		break
	elif raw_guess.isdigit() and len(raw_guess) == 4 and (len(zeros) <= 1 or len(ones) <= 1 or len(twos) <= 1 or len(threes) <= 1 or len(fours) <= 1 or len(fives) <= 1 or len(sixes) <= 1 or len(sevens) <= 1 or len(eights) <= 1 or len(nines) <= 1):
		print("Each digit in your guess must be different. Try again\n")
	else:
		print("Your guess must be a 4-digit number.  Try again\n")
 
#stage input
guess = {}
for i in range(len(raw_guess)):
	guess[int(raw_guess[i])] = {'bull': False, 'cow':False}
guess_list = list(guess.keys())

#when the game ends
def endofgame():
        while True:
                user_answer = input("Would you like to play this again? ")
                if user_answer == "yes":
                        print("Placeholder")
                elif user_answer == "no":
                        raise SystemExit
                else:
                        print("You must answer either 'yes' or 'no.'\n")
#has user figured out the secret code?
if guess.keys() == secret_code:
	print("You Win!")
	endofgame()
#no - process the guess
 
#check for bulls and cows
for i in range(len(secret_code)):
	if guess_list[i] == secret_code[i]:
		guess[guess_list[i]]['bull'] = True		#bull - both digit and position are correct
	elif secret_code.count(guess_list[i]):
		guess[guess_list[i]]['cow'] = True		#cow - digit is correct but not position
 
#accumulate bull/cow counts
cntf = lambda x: sum(1 if guess[i][x] else 0 for i in guess_list)
bullcnt = cntf('bull')
cowcnt = cntf('cow')
 
#display results
print("You have %i bull%s and %i cow%s" % (bullcnt, bullcnt!=1 and 's' or '', cowcnt, cowcnt!=1 and 's' or ''))

#did the player lose?
for i in range(len(secret_code)):
        secret_code[i] = str(secret_code[i])
print("You lose...sorry.\nThe secret code was " + "".join(secret_code)+ ".")
endofgame()
